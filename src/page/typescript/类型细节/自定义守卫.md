<br/>warning
âš ï¸ æ³¨æ„

æœ¬æ–‡å†…å®¹ä»…åœ¨ typescript@5.5 ä¹‹å‰æœ‰æ•ˆï¼Œè¿™ä¸ªé—®é¢˜å·²ç»åœ¨æ–°ç‰ˆæœ¬ä¸­ä¿®å¤ï¼Œ[è¯¦è§](https://devblogs.microsoft.com/typescript/announcing-typescript-5-5/#inferred-type-predicates)ã€‚

<br/>

è‡ªå®šä¹‰å®ˆå«æ˜¯æŒ‡é€šè¿‡`{å½¢å‚} is {ç±»å‹}`çš„è¯­æ³•ç»“æ„ï¼Œæ¥ç»™è¿”å›å¸ƒå°”å€¼çš„æ¡ä»¶å‡½æ•°èµ‹äºˆç±»å‹å®ˆå«çš„èƒ½åŠ›ã€‚



é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ¥è®²è¿°ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬å¯èƒ½ä¼šåœ¨ä¸€ä¸ªå‡½æ•°å†…å¯¹ä¸€ä¸ªæ•°æ®çš„ç±»å‹è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åå†è¿›è¡ŒæŸäº›æ“ä½œï¼š

```typescript
function foo(input: string | number) {
    if (typeof input === "string") {
        // do something...
        console.log(input.toUpperCase());
    } else {
        // do something...
        console.log(input.toFixed());
    }
}
```

å¯æ˜¯å¦‚æœå¯¹`input`çš„åˆ¤æ–­éå¸¸çš„å¤æ‚ï¼Œæˆ‘ä»¬å°±ä¼šå•ç‹¬çš„å†æŠ½ç¦»ä¸€ä¸ªå‡½æ•°ï¼š

```typescript
function isString(input: any) {
    return typeof input === "string";
}
function isNumber(input: any) {
    return typeof input === "number";
}

function foo(input: string | number) {
    if (isString(input)) {
        // ğŸ¤” (parameter) input: string | number
        console.log(input.toUpperCase()); // âŒ Property 'toUpperCase' does not exist on type 'number'.
    } else if (isNumber(input)) {
        // ğŸ¤” (parameter) input: string | number
        console.log(input.toFixed()); // âŒ  Property 'toFixed' does not exist on type 'string'
    }
}
```

è¿™æ˜¯å› ä¸ºã€Œç±»å‹ç¼©çª„ã€åªèƒ½åœ¨åŒä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå¦‚æœåœ¨ä¸åŒçš„å‡½æ•°ä¸­å°±ä¸èµ·ä½œç”¨äº†ã€‚

æˆ‘ä»¬å¯ä»¥åŠ ä¸Šã€Œè°“è¯­åŠ¨è¯ã€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```typescript
// input is string è¡¨ç¤ºå‡½æ•°è¿”å› true çš„æ—¶å€™ï¼Œå°±å°† input æ›´æ”¹ä¸º string ç±»å‹
function isString(input: any): input is string {
    return typeof input === "string";
}
// input is number è¡¨ç¤ºå‡½æ•°è¿”å› true çš„æ—¶å€™ï¼Œå°±å°† input æ›´æ”¹ä¸º nunber ç±»å‹
function isNumber(input: any): input is number {
    return typeof input === "number";
}

function foo(input: string | number) {
    if (isString(input)) {
        // ğŸ¤” (parameter) input: string
        console.log(input.toUpperCase()); // âœ…
    } else if (isNumber(input)) {
        // ğŸ¤” (parameter) input: number
        console.log(input.toFixed()); // âœ…
    }
}
```



è‡ªå®šä¹‰çš„ç±»å‹å®ˆå«åœ¨æˆ‘ä»¬åšä¸€äº›æ¯”è¾ƒå¤æ‚çš„ç±»å‹åˆ¤æ–­çš„æ—¶å€™æ¯”è¾ƒæœ‰ç”¨ï¼š

```typescript
type Box = {
    _v_isBox: boolean;
    value: any;
};

function isBox(box: any): box is Box {
    return box && box._v_isBox === true;
}

function unWrapBox(box: Box) {
    return isBox(box) ? box.value : box;
}
```

ï¼ˆä»¥ä¸Šä»£ç å‡è®¾å¾ˆå¤æ‚ï¼‰



<br/>tips
â•ä¿¡æ¯

æˆ‘ä»¬ä¹‹å‰è®²è¿°çš„ï¼šå­—é¢é‡çš„ç±»å‹æ£€æŸ¥ã€`typeof`ã€`instanceof`ã€`in`ä»¥åŠè‡ªå®šä¹‰å®ˆå«åœ¨ TypeScript ä¸­æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ç§°å‘¼ï¼Œéƒ½å«åšç±»å‹å®ˆå«ï¼Œå…¶ç›®çš„éƒ½æ˜¯åœ¨æ§åˆ¶æµåˆ†æçš„æ—¶å€™ï¼Œå¸®åŠ© TS è¿›è¡Œç±»å‹ç¼©å°ï¼Œä¾¿äºåˆ¤æ–­ã€‚

<br/>

